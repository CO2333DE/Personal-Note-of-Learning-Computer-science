【xx】标注为课后**复习题**

# 第1章 计算机安全概述

计算机狂人老时，只讲第1-12章，包括原理和软硬件安全，后面的网络安全要自己读；

明显对系统造成损害的操作，建议在虚拟机中执行！比如缓冲区溢出实验

## 1.1 计算机安全的概念

计算机安全的定义/三个目标：**CIA**

**【1.1】计算机安全是指为实现信息系统资产（包括硬件，软件，固件，信息/数据和电信）的完整性，可用性和机密性的适用目标而对自动化信息系统提供的保护。**

另有真实性和可说明性（accountability，防范抵赖（数字签名））；

资产包括软件、硬件、固件以及信息。

### 1.1.1 机密性 Confidentiality 被泄露

实例：教务系统的学生信息、空间访问权限、微信朋友圈仅聊天

#### 数据机密性

信息保证不泄露

#### 隐私性 

信息可控制提供给谁

### 1.1.2 完整性 Integrity 被更改

实例：有密码/口令的人才能查看或修改文件、恶意代码植入（破坏了完整性）

#### 数据完整性

保证数据不被改变

#### 系统完整性

操作系统的系统调用/特权指令可以在预期内正确地执行

### 1.1.3 可用性 Availability 不可用

### 1.1.4 真实性

### 1.1.5 可说明性 Accountability

## 1.2 威胁、攻击、资产

### 1.2.1 威胁

【1.2】**被动威胁与窃听或监视传输有关。 如电子邮件，文件传输和客户端/服务器交换是可以监视的。 **

**主动威胁包括修改传输的数据以及试图获得对计算机系统的未授权访问**。

原因：分为内因和外因。内因主要是人为设计的问题，外因是黑客技术的泛滥。

#### 非授权泄露：机密性

![image-20220622133549430](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220622133549430.png)

未经授权而获得数据访问，攻击方式：直接泄露（人为）、截获（搭线窃听）、推理（sniff，根据通信量推理）、入侵（绕过防火墙）

#### 欺骗：系统完整性或数据完整性

![image-20220622133635156](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220622133635156.png)

导致授权实体接收了虚假的数据并相信其正确性。攻击方式：冒充（木马）、伪造（伪造虚假数据）、抵赖（否认对行为的责任）

#### 破坏：系统可用性或完整性

![image-20220622134738648](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220622134738648.png)

阻止系统服务功能正常运行。攻击方法：失能：物理破坏、硬件；恶意软件、木马、病毒、蠕虫、损坏：后门（原本是测试人员为了方便检查而设置）、阻碍：中断通信

【CIH病毒】第一个能破坏计算机硬件的病毒。表现为硬盘数据全部丢失、无法开机。利用汇编语言，改变ROM中的数据。

#### 篡夺：破坏系统完整性

系统被控制了。攻击方法：盗用：DDoS&Botnet、误用：恶意代码或自主删除系统文件

#### 【威胁总结】

![image-20220622134349648](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220622134349648.png)

### 1.2.2 攻击

【1.3】

网络安全攻击可以划分为被动攻击和主动攻击

**被动攻击：目标是了解或利用系统信息，但不影响系统资源。如：消息内容泄露、流量分析 **

**主动攻击：试图改变系统的资源或影响其运行。如：冒充，重放，篡改消息和拒绝服务。**

## 1.4 基本安全设计原则

#### 【1.4】列出并简要定义安全服务的种类	

​	**身份验证：确保通信实体是它声称的实体。**

​    **访问控制：** 防止未经授权使用资源（即，此服务控制谁可以访问资源，在什么条件下可以进行访问，以及允许访问资源的人做什么）。 

​    **数据机密性：** 保护数据免遭未经授权的披露。 

​    **数据完整性：** **确保接收的数据与授权实体发送的数据完全相同（即，不包含任何修改、插入、删除或重放）。** 

​    **不可否认性：** 提供保护，防止通信中涉及的某个人拒绝参与全部或部分通信。 

​    **可用性服务：** 系统或系统资源的属性，可由授权的系统实体根据系统的性能规范按需访问和使用（即，如果系统在用户请求时根据系统设计提供服务，则系统可用）。 

## 1.5 攻击面和攻击树【1.5】

【1.5解释攻击面与攻击树的不同】

### 1.5.1 攻击面

攻击面是由系统中可访问的和可被利用的漏洞构成的

### 1.5.2 攻击树

攻击树是一种分支的、层次化的数据结构，表示一组利用安全漏洞进行攻击的潜在技术。

根节点：攻击目标的安全事件 ；子节点：完成攻击事件的子目标 ；叶子结点：发起一个攻击的不同方式

有点像思维导图，每一层次的叶子结点都是攻击方式

# 第2、20、21章 密码学

密码学分为密码编码学和密码分析学。

#### 密码算法的两个基本函数【20.2】

所有的加密算法都是基于两个原理：代换和置换

替换（substitution ）把明文P中的某个字符换为另外一个字符

置换（permutation）把明文P中的字符重新排列

替换密码的两难境地：要方便密码员记忆，但规律性可能给破译者提供方便。

## 2.1 数论基础

求最大公因数（Greatest Common Divisor）方法：辗转相除法、更相减损术

### 2.1.1 辗转相除法（欧几里得算法）

```python
#在python中，//是除法，/是取整，%是取余
a, b = map(int, input("输入两个数").split())
a1, b1 = a, b
res = a1 % b1
while res != 0:
    a1 = b1
    b1 = res
    res = a1 % b1
print("最大公约数为："+str(b1)+"最小公倍数为："+str(a*b/b1))
```

两整数的最大公约数等于其中较小的那个数和两数相除余数的最大公约数

因此只需要把两数辗转用上面的结论就可以步步推出原数的公约数

扩展的欧几里得算法常用于**RSA密钥**

### 2.1.2 欧拉函数

所有小于n的与n互素的正整数的个数。欧拉函数计算如下

- p，q为素数，且n = p * q

$$
\phi(n)=\phi(p)\phi(q)=(p-1)(q-1)
$$

- n不能分解为两个素数

$$
\phi(n) = n(1-\frac{1}{p_1})(1-\frac{1}{p_2})...(1-\frac{1}{p_n})
$$

for eg：![image-20220623151405236](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220623151405236.png)

### 2.1.3 离散对数

求幂的逆向问题:
$$
y = a^x\mod p
$$
转化为离散对数：
$$
x = log_a y \mod p
$$
显然，求离散对数是非常难求的。而正向的求幂则是较容易的，所以密码的破译是困难的。

### 2.1.4 扩展的欧几里得算法

#### 贝祖等式

--待续

## 2.2 对称加密/单密钥加密

密码学是关于如何在敌人存在的环境中通讯

斯巴达密码棒、凯撒密码、棋盘密码、隐形墨水

**安全性基于加密算法的保密**，可以利用统计规律综合猜测（频率分析），只要知道了加密原理就可以很容易破解



现代密码学主要技术：数据的安全基于密钥而不是加密算法。

- 公钥密码技术
- 对称密码
- 后量子密码

特点：收发双方共享秘密密钥(secret key)，解密和加密实际上是完全相同的密钥（区分双钥）

#### 安全使用对称加密的基本要求【2.3】

1. 加密算法足够强：即使敌手拥有一定数量的密文和对应的明文，他也不能破译出密文或密钥
2. 密钥和算法的传输过程安全

#### 对称密码的基本要素【2.1】

1. 明文
2. 加密算法
3. 密钥：**也是加密算法的输入**；算法所用的特定的代换和变换依赖于密钥【2.2】使用对称密码的双方只需要一个密钥
4. 密文
5. 解密算法：加密算法的逆运算；输入密文和密钥可以恢复明文

#### 攻击对称加密方法

1. 密码分析：简而言之就是利用算法的性质和明文-密文对的样本推导出密钥
2. 蛮力攻击：暴力穷举，可规定输入次数解决

### 2.2.1 分组加密算法：加密速度快

设计原理：将明文信息编码后的数字序列划分成等长的组，一次处理一个组（大小一般为64或128 bit）

设计准则：安全性、简洁性、有效性

对抗统计分析：

1. 混乱（confusion）如替换（最好是非线性替换），确保密文、明文、密钥之间关系尽可能复杂。“搅拌机”熵要大

2. 扩散（diffusion）如置换，将明文中的一位影响到多位

##### 【20.6】为什么某些分组密码的操作模式仅使用加密算法，而其他的模式既使用加密算法又使用解密算法?

答:出于加密与解密的考虑，一个密码模式必须保证加密与解密的可逆性。

在密码分组链接模式CBC中，对明文与前一密文分组异或后加密，在解密时就要先解密再异或才能恢复出明文;在计数器模式CTR中，对计数器值加密后与明文异或产生密文，在解密时，只需要相同的计数器加密值与密文异或就可得到明文。

#### DES(Data Encryption Standard)算法

明文和密文为64位分组长度

DES强度由密钥长度决定，如56 bit密钥有2^56个可能值。

- 抗穷举能力弱——提出替代方案：


#### 双重DES

长度2*56=112

2DES不安全在于可以中间相遇攻击大幅度减小求密钥的运算量：假设已经获得了明文和密文，对密钥空间2^56的所有可能求明文的加密结果并存储至数组，再对密钥空间所有可能求密文的解密结果看看在不在数组里面，如果在就称为中间相遇，这种攻击方法复杂度只略大于2^57，显著低于加密两次用到112位密钥2^112。

![image-20220624142635558](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220624142635558.png)

- **不抗中间相遇攻击**，于是提出 3DES

#### 三重DES

##### 【20.7】什么是三重加密？

三重加密：通过加密算法对明文块进行加密；然后将结果再次通过相同的加密算法；第二次加密的结果第三次通过相同的加密算法。通常，第二阶段使用解密算法而不是加密算法。

##### 【20.8】为什么3DES的中间部分使用解密而不是加密？

第二步采用解密运算并没有什么密码学上的含义，这仅仅是为了使用三重DES的用户可以利用该算法解密单DES加密的数据。当用同样的key（即k1=k2=k3=k）带入E(k3,D(k2,E(k1,m)))时，里面两层的D和E消去，3DES就会退化为一个普通的DES

![image-20220624142654475](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220624142654475.png)

- 抗中间相遇攻击

#### AES

操作都是替换、置换、移位、加、异或，能够在许多CPU上高效实现。能够抵御任何已知的攻击

能够抵御线性攻击和差分攻击。

#### Feistel 密码

每轮迭代的轮函数F相同，但每轮的输入是上一轮的输出

![image-20220624143019204](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220624143019204.png)

### 2.1.2 流密码

一次只对明文中的的单个位（字节）进行加密

#### 电子密码本ECB

并行简单、没有误差传递；不能隐藏明文的模式信息

#### 密码分组链接CBC

像链子。相比于ECB增加了一次异或，可以隐藏模式信息。但是解密有误差传递

在CBC模式中，要得到4的结果需要解密123

![image-20220624153229212](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220624153229212.png)

对CBC模式的攻击：对初始化向量IV进行攻击（某个比特反转），而不是密文分组

#### 分组密码和流密码区别【20.4】

分组密码一次处理输入的一组元素，每组输入产生一组输出。

流密码持续地处理输入元素，随着处理的继续，每次输出一个元素

## 2.3 消息认证和散列函数

**对称加密和公钥密码体制主要针对保密性，消息认证保证完整性**

哈希函数和非对称不一样，因为哈希函数只是存储了哈希值，不对其进行解密，而是使用再次输入生成的哈希值对比的方法进行认证

#### 目的

- 信源识别：验证发信人

- 验证消息完整性：发送过程中是否被篡改、重放、延迟


#### 三种消息认证的实现方法【2.4】

1. **对称加密**：双方事先商议好对称密钥K
2. **无需加密的消息认证码**：
3. **散列函数**：倾向于使用，因为更快低成本而且不给钱

### 2.3.1 对称加密实现消息认证

推荐DES算法

![image-20220625130710420](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220625130710420.png)

### 2.3.2 无需加密的消息认证

#### 消息认证码MAC【2.5】

用密钥生成一个固定长度的短数据块MAC，并将其附着在消息之后（假定只有收发双方知道密钥）

#### HAMC

HMAC是认证消息码的一种变形，基于散列函数的消息认证码。（基于hash的mac）

- 一般像MD5和SHA这样的密码箱hash函数，软件执行速度比诸如DES这样的对称分组密码要快
- 有许多共享的密码箱hash函数代码库

【21.3】用一个哈希函数替代另一个哈希函数，HMAC只需删去现有的hash函数模块，并加入新的模块。

输入消息M（长度不定），输出为消息摘要H(M)（长度固定）。由此，M->H(M)，但反之不可。若散列函数以密钥作为输入，则该散列函数会变得不可用。

哈希函数不使用密钥，哈希函数是多对一的映射（长度不定--固定）

![image-20220625133255979](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220625133255979.png)

##### 用于消息认证的散列函数H应该有的性质【2.7】

**1.**  H 可以应用于任何大小的数据块。（输入长度不定） 

**2.**  H 产生一个固定长度的输出。 （输出长度固定）

**3.**  对于任何给定的 *x，H（*x*）相对容易计算，这使得硬件和软件实现都变得实用。 

**4.**  对于任何给定值 *h*，在计算上找不到 *h* （*x*） = *h* *的 x*。 （单向性，抗原象性）

**5.**  对于任何给定的块 *x*，在计算上找不到 *y* ≠ *x* ，其中 H（*y*） = H（*x*）。 （第二抗原象，弱碰撞性）

**6.**  在计算上，找到任何一对（*x*，*y*）使得H（*x*） = H（*y*）是不可行的。（强，抗碰撞性）

##### Hash应用

1. **口令**：实际上QQ密码不算密码，因为没用加密算法，只是将一个口令生成了hash值存储。**要求抗原象性**
2. **入侵检测**：对电脑中的文件F，计算H(F)并保存。可通过重新计算H(F)检测文件是否被修改。**要求第二抗原象性**

##### SHA系列

美国国安局设计。SHA-1生成160位（20字节），通常用40个16进制数表示；其余的SHA后面的位数表示摘要位数

md5和sha1都被王小云团队破解了

### 2.3.3 安全散列函数SHA

【21.2】基本算术和逻辑函数

mod，循环移位、基于AND、OR、NOT和XOR的原始布尔函数

## 2.4 非对称加密/双钥加密

#### 对称加密存在的问题

- 密钥膨胀问题：对称加密每一对用户需要一对密钥，n个用户需要n*(n-1)/2个密钥
- 抗抵赖问题：对称加密无法确认一个消息是否由发送方发出-----数字签名

【2.1】使用对称加密通信的两个人需要一个密钥，但使用非对称加密需要**4个**（每人各一对）

#### 非对称加密的基本要素【2.8】

1. **明文：** 这是可读的消息或数据，像 input 一样馈送到算法中。 
2. **加密算法：** 加密算法对明文执行各种转换。 
3. **公钥和私钥：** 这是一对已选择的密钥，因此**如果一个用于加密，则另一个用于解密**。加密算法执行的转换取决于作为输入提供的公钥或私钥。
4. **密文：** 这是作为输出生成的加扰消息。这取决于明文和密钥。对于给定的消息，两个不同的密钥将生成两个不同的密文。
5. **解密算法：** 该算法接受密文和匹配密钥，并生成原始明文。 

#### 非对称加密的应用【2.9】

1. 加密/解密：如 发件人使用收件人的公钥加密邮件
2. 数字签名：发件人使用其私钥“签名”消息。签名是通过应用于消息或作为消息函数的一小块数据块的加密算法实现的。
3. 密钥管理：密钥分发、密钥交换

#### 私钥和密钥的区别【2.10】

传统加密中使用的密钥通常称为 **密钥**。用于公钥加密的两个密钥称为 **公钥** 和 **私钥**。

### 2.4.1 非对称加密原理

加密和解密时使用两种不同的密钥完成：

#### 公钥加密：提供机密性

加密使用公钥，可以公开被任何人使用；解密使用私钥，只有接收者本人知道。

![image-20220715140459587](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220715140459587.png)

#### 私钥加密：提供认证和数据完整性

在数字签名中，加密使用签名者的本人的私钥（保证签名不被他人滥用），公钥用于接收者对签名解密（认证机构CA防止抵赖）

![image-20220715140515528](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220715140515528.png)

### 2.4.2 RSA密钥

安全性基于：很大的合数，其素数分解是非常困难的。暴力枚举所有可能的私钥是不可行的。

for eg：p=100000000000078，q=2000000000037

n=pq=... 分解这个合数非常困难

#### 攻击RSA算法

1. 蛮力攻击
2. 数学攻击：设法分解两个素数的乘积
3. 计时攻击（唯密文攻击）：通过计算解密算法的运行时间确定计算私钥
4. 选择密文攻击

#### 加密和解密过程

收发双方均已知n，发送方知道公钥e，接收方知道私钥d。m为明文分组，c为密文分组，则
$$
加密：c=m^e\mod n,解密：m=c^d\mod n
$$
![image-20220625153704734](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220625153704734.png)

错了，ed应该满足这个

![image-20220625154949652](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220625154949652.png)

#### RSA密钥的创建

![image-20220625154732454](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220625154732454.png)

举例

![image-20220625155324971](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220625155324971.png)

### 2.4.3 Diffie-Hellman密钥交换

它是一种**建立密钥的方法/密钥交换算法**，而不是加密方法，所以密钥必须和其他一种加密算法结合使用。
这种秘钥交换技术的目的在于使两个用户安全的交换一个秘钥一遍，后面的报文加密。

![image-20220715204314664](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220715204314664.png)

## 2.5 数字签名和密钥管理（公钥的应用）

消息认证并不能保证通信双方的相互攻击和欺骗，（人为因素）包括伪造发送消息和抵赖发过的消息等。

### 2.5.1 数字签名【2.11】

【2.11】**数字签名**（digital signature）是一种身份验证机制，数字签名是附加在数据单元上的一些数据或对数据单元作的密码变换。**数字签名实际上带有消息认证的功能。**它使消息的创建者能够附加充当签名的代码。保证消息的来源和完整性。

Bob：用散列函数对消息M得到散列值，再用私钥对散列值加密得到数字签名S，发送(M,S)

Alice：用散列函数对消息M得到散列值，再用公钥解密Bob的签名S，比较计算出的散列值和解密出的散列值是否相同

![image-20220625162001381](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220625162001381.png)

#### 三种数字签名算法

1. DSA：基于计算离散对数的复杂性
2. RSA-DSA：基于RSA公钥加密算法
3. 椭圆曲线DSA：基于椭圆曲线密码

#### 数字签名的性质

1. 不可伪造
2. 真实性
3. 不可变
4. 不可重用
5. 任何人均可验证

#### 数字签名算法 DSA

![image-20220625160507142](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220625160507142.png)

#### 数字签名待解决的问题

公钥算法效率低，常常与散列函数结合使用

“签名+加密”提供“真实性+保密性”

### 2.5.2 公钥证书【2.12】

提出的原因：公钥是公开的，因此任何人都可以伪造公钥的所属权，解决此的方法是公钥证书

公钥证书由公钥、 公钥所有者的用户 id 和可信的第三方（用户团体所
信任的认证中心 CA） 签名的整数数据块组成， 用户可通过安全渠道把它的公钥提交给 ca，
获得证书。

**公钥证书**通常是由第三方是被信任的证书颁发机构 CA颁发给用户，以证明密钥合法性的。由 **公钥**和密钥所有者的**用户ID**组成，整个块由受信任的第三方签名。

#### 密钥生成和公钥分发

![image-20220625152605626](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220625152605626.png)



### 2.5.3 密钥分发【2.13】

##### 【20.10】密钥分发有以下几种方法：

![image-20220715194223829](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220715194223829.png)

##### 【2.13】怎样利用公钥加密实现秘密密钥的分发

1. Diffie-Hellman密钥交换。
2. 让发件人使用收件人的公钥加密密钥

##### 【20.11】会话密钥和主密钥的区别？

![image-20220715194541246](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220715194541246.png)

会话密钥是两个主体之间使用的临时加密密钥。主密钥是密钥分发中心和主体之间用于编码会话密钥传输的永久密钥。（有点像ftp的主子进程）

##### 【20.12】什么是密钥分发中心？

密钥分发中心Key Distribution Center 为共享密钥的双方提供一个一次性会话密钥

#### 链路加密

链路加密 (又称在线加密) 是传输数据仅在物理层前的数据链路层进行加密。接收方是传送路径上的各台节点机，信息在每台节点机内都要被解密和再加密，依次进行直至到达目的地。

#### 端到端加密

端到端加密允许数据在从源点到终点的传输过程中始终以密文形式存在。采用端到端加密 (又称脱线加密或包加密), 消息在被传输时到达终点之前不进行解密，因为消息在整个传输过程中均受到保护，所以即使有节点被损坏也不会使消息泄露。

# 第3章 用户认证

操作者的现实身份和数字身份应该如何对应？

#### 认证方法【3.1】

1. 基于口令的认证：个人所知道的信息
2. 基于令牌的认证：个人所持有的物品
3. 基于生物特征的认证：静态：指纹、虹膜、人脸；动态：语音识别、打字习惯
4. 基于远程的认证

#### 保护口令文件的两个常用方法【3.3】

1. 使用标准**访问控制措施限制**对密码文件的**访问**
2. 强制用户选择**难以猜测的密码** 

## 3.1 基于口令的认证

用户账号+口令 = 数字身份

### 3.1.1 口令攻击策略和对抗措施【3.2】

**1. 离线字典攻击** 

攻击者首先要绕过访问控制获得散列值，与常用的哈希值字典比较（比如123456这种简单密码的哈希值散列值肯定会有字典保存）

对抗措施：防止非授权访问口令文件、入侵检测技术、不安全口令重新设置

**2. 特定账户攻击**

攻击者以特定帐户为目标并提交密码猜测，直到发现正确的密码。

对抗措施：账户锁定机制（口令错误超过五次锁定账户）

**3. 常用口令攻击**

用一个常用口令对大量的用户ID进行尝试

对抗措施：禁止用户选择常用口令或简单口令

**4. 单用户口令猜测**

攻击者获得该用户的个人信息和保护策略并猜测

对抗措施：口令最小长度、字符集、禁止使用常用ID、重输口令时间长度

**5. 工作站劫持**

管理员不注意时劫入工作站

对抗措施：工作站非工作时自动注销；入侵检测

**6. 利用用户疏漏**

社会工程学。比如把密码写在纸上被人看到了

**7. 利用口令重用**

一个用户对不同的网络设备用相同的密码

**8. 电子监视**

#### 举例

windows操作系统下，C:\Windows\System32\config内有一个SAM文件，存储操作系统的用户名和密码，如果删掉了该文件，则可以破解windows登录

策略：口令文件访问控制。文件的散列口令只能被特权用户访问

### 3.1.2 散列口令

盐值一般使用伪随机数或随机数生成。**盐值用明文存储**。盐值的明文与用户名、散列值一起存储。

作用：如果没有加盐，攻击者在猜出密码之后会匹配到多个相同口令的用户ID；加盐之后，攻击者必须猜测密码，并且为每个用户使用特定的盐值计算，不仅增加了计算的难度并且增加了离线字典攻击的匹配难度。 



![image-20220626150728463](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220626150728463.png)

### 3.1.3 口令选择策略【3.4】

设置和选择口令的四种常用方法

1. 用户教育
2. 计算机生成口令：足够随机，但是难于记忆
3. 后验口令检查：系统周期性运行口令破解程序，一旦破解就会取消口令并通知用户
4. 先验口令检查：指定用户设置强度足够高的口令；构造不能作为口令的字符串组成的口令字典（口令破解器）

## 3.2 基于令牌的认证

令牌：用户持有的应用于进行用户认证的一种物品

存储卡可以存储数据，但不能处理数据。智能卡具有微处理器。 

![image-20220627134944235](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220627134944235.png)

#### 智能卡-认证协议

- 静态协议：令牌认证用户，计算机认证令牌
- 动态口令生成器：每隔一段时间产生一个口令，计算机和令牌需保持同步
- 挑战应答协议

## 3.3 基于生物特征的认证

#### 认证流程

**注册** 类似于为用户分配密码。对于生物识别系统，用户向系统提供名称，通常为某种类型的密码或 PIN 。同时，系统感知到该用户的一些生物特征（例如，右食指的指纹）。系统将输入数字化，然后提取一组特征，这些特征可以存储为一个数字或一组数字，以表示这种独特的生物特征;这组数字被称为用户的模板。用户现在已在系统中注册，该系统为用户维护名称 （ID）、PIN 或密码以及生物识别值。 

**验证**  类似于用户使用存储卡或智能卡以及密码或 PIN 登录到系统。对于生物识别验证，用户输入 PIN 并使用生物识别传感器。系统提取相应的特征，并将其与为此用户存储的模板进行比较。如果存在匹配项，则系统将对此用户进行身份验证。

**识别** 检查数据库内该用户是否注册过

#### 【3.8】误匹配率、漏匹配率、阈值

误匹配率：系统将冒名顶替者的生物特征与用户错误匹配成功的概率

漏匹配率：已注册的用户与用户存储的生物信息不匹配的概率

阈值提高，误匹配率会下降，漏匹配率上升；

阈值减少，误匹配率会上升，漏匹配率下降。

## 3.4 远程用户认证

1. telnet 23端口

2. 【3.9】**挑战-应答协议**：用户尝试登录到服务器。服务器发出某种挑战 ，用户必须响应这些挑战才能进行身份验证。 

   每次生成一个不同的随机数，防止重放攻击（如利用WireShark抓取发送的信息再次发送给主机，该主机无法判断这是重传还是未知源消息，于是便信任该来源）具体过程为

   1. 用户发送其身份ID
   2. 远程主机发送随机数r
   3. 用户用自己的口令P，计算f(r,h(P))，并发送给远程主机
   4. 远程主机计算该值进行匹配

   ![image-20220627141115351](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220627141115351.png)

3. 动态口令卡：手机号的动态验证码，每次发的都不一样

## 3.5 用户认证中的安全问题

![image-20220627140919157](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220627140919157.png)

# 第4章 访问控制

从广义上来讲，所有计算机安全都与访问控制有关。下图便是文件的访问控制权限

![image-20220627144704635](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220627144704635.png)

计算机安全的主要目标是防止非授权用户对资源的访问，防止合法用户以非授权方式访问资源。

访问控制三个内容：

1. 认证
2. 控制策略实现
3. 审计

![image-20220627144332567](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220627144332567.png)

## 4.1 访问控制原理

#### 访问控制基本元素【4.4】【4.5】

1. 【4.3】主体（能够访问客体的实体,等同于**进程**）：所有者、组、世界
   - **所有者：**资源的创建者，例如文件。对于系统资源，所有权可能属于系统管理员。对于项目资源，可以向项目管理员或领导者分配所有权。
   - **组：** 除了分配给所有者的权限外，还可以向指定的组用户授予访问权限，以便组中的成员身份足以行使这些访问权限。在大多数方案中，一个用户可能属于多个组。
   - **世界**：向能够访问系统但未包含在此资源的类别所有者和组中的用户授予最少的访问权限。
2. 客体（外界对其访问受到控制的资源）：记录、块、页、文件
3. 访问权（主体访问客体的方式）：读、写、执行、删除、创建、搜索

#### 访问控制策略

1. 自主访问控制
2. 强制访问控制
3. 基于角色的访问控制
4. 基于属性的访问控制

## 4.2 自主访问控制 Discretionary Access Control

一个实体可以被授权按其自己的意志使得另一个实体能够访问某些资源

优点：粒度小

缺点：工作量大，复杂

#### 访问控制矩阵【4.6】

访问控制矩阵：按列看是访问控制表；按行看是访问能力表

访问控制表*ACL*：列出了用户及其允许的访问权限

访问能力表/能力权证：指定每个用户的授权客体和操作。 

授权关系表：顺序表

#### 保护域【4.7】

访问矩阵的一行定义一个保护域

## 4.3 强制访问控制 Mandatory Access Control

#### 定义

主体的权限和客体的安全属性都是固定的，由系统决定主体是否可以访问客体。不允许主体干涉访问控制。

优点:等级性,安全性高

缺点:灵活性差,被动的

#### “强制”体现在

1. 由系统或管理员按照严格的安全策略事先设置主体权限和客体安全属性
2. 主体不能修改客体属性
3. 主体不能将自己的部分权限授予其他主体。
4. 系统独立于主体强制执行访问控制

#### MAC过程

1. 主体被分配一个安全等级（安全标签)
2. 客体也被分配一个安全等级（安全标签)
3. 访问控制执行时，对主体和客体的安全标签进行比较（绝密级、机密级、秘密级、无密级）

访问控制关系分为：（类似上下级关系）

向上读/向下写（完整性）

向下读/向上写（机密性）机密信息不会向下级泄露

## 4.4 基于角色的访问控制RBAC

根据用户在系统中的角色和规则来控制访问，一个身份被分配给一个被授权的组。这些规则规定了允许给定角色中的用户进行哪些访问。

#### RBAC与DAC/MAC的联系【4.2】

**基于角色的 访问控制 （RBAC）** 根据用户在系统中的角色和规则来控制访问，这些规则规定了允许给定角色中的用户进行哪些访问。RBAC可能有DAC或MAC的机制。 角色控制相对独立，可以配合某些角色接近于MAC或DAC。增加一层间接性，从而带来了灵活性。

#### 四种RBAC模型【4.8】

RBAC0 包含 RBAC 系统的最低功能。RBAC1 包括 RBAC0 功能并添加了角色层次结构，使一个角色能够从另一个角色继承权限。RBAC2 包括 RBAC0 并添加了约束，这些约束限制了 RBAC 系统组件的配置方式。RBAC3 包含 RBAC0、RBAC1 和 RBAC2 的功能。 

![image-20220629142229560](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220629142229560.png)

![image-20220627152155477](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220627152155477.png)

#### RBAC的四种实体类型【4.9】

- **用户：** 有权访问此计算机系统的个人。每个人都 有一个关联的用户 ID。 
- **角色：** 组织内控制此计算机系统的命名工作职能。通常，与每个角色相关联的是授予此角色以及承担此角色的任何使用 r 的权限和责任的描述。 
- **权限：** 对一个或多个对象的特定访问模式的批准。等效的术语是访问权限、特权和授权。 
- **会话：** 用户与用户分配到的角色集的已激活子集之间的映射 。 

#### RBAC2三种类型的角色层次约束【4.10】

**互斥角色**是指一个用户只能被分配到集合中的一个角色的角色。 

**基数**是指设置相对于角色的最大数量。

**先决条件**如果已将用户分配给某个其他指定角色，则只能将用户分配给该角色。 

## 4.5 基于属性的访问控制ABAC

较新的进展

三个关键要素：**属性、策略模型、架构模型**

## 4.6 安全级别TCSEC

由低到高：

- D 没有任何限制
- C(C1,C2) 自由选择性安全保护，主要是自主访问控制
- B(B1,B2,B3) 提供自主、强制访问控制
- A 验证设计级别，军用

# 第5章 数据库与云安全

数据库安全的现状：

1. 数据库安全始终没有跟上数据库应用的步伐：DBMS的复杂程度在不断增加，但安全技术却不能匹配其复杂度；结构化查询语言SQL也很复杂。
2. 一些组织越来越依赖云技术，增加了安全的负担
3. 数据库存储的大量重要的信息，一些组织趋向于把敏感信息集中存储在一个单一的逻辑数据中

 ## 5.1 数据库的基本概念【5.1】

DBMS：**数据库管理系统** ，它是一套用于共同构建和维护数据库以及为多个用户和应用程序提供即席查询功能的程序。

DB：**数据库**是存储供一个或多个应用程序使用的数据的结构化集合。除了数据之外，数据库还包含数据项和数据项组之间的关系。

查询语言：为用户和应用程序提供统一的数据库接口。 

授权表：用于确保用户具有执行数据库查询语句的权限

并发访问表：用于同时执行冲突命令时，避免产生冲突

关系数据库&非关系数据库

### 5.1.1 关系型数据库 RDBMS【5.2】

行=元组-记录，主键唯一标识某一行

列=属性=字段

关系=表=文件

一个表的外键是另一个表的主键

主键的值对于其表的每个元组（行）必须是唯一的，而外键值可以在表中多次出现。 

视图是虚表，是暂时选取被展示出来的

有信息删改时，改动量非常巨大

#### 数据库的完整性

- 数据完整性：使用户相信数据库中的数据值是正确的
- 物理完整性：热插拔
- 逻辑完整性：减少不必要的关联（低耦合）、删改时不会改变其他域的问题

### 5.1.2 结构化查询语言 Structure Query Language



## 5.2 SQL注入攻击

#### SQLi 的两种形式

1. 用户的输入被当作嵌入在SQL语句中的转义字符而被错误的过滤
2. 用户输入是非强类型而被意外执行

### 5.2.1 SQLi攻击途径

#### 1. 用户输入

![image-20220628145042618](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220628145042618.png)

#### 2. 服务器变量

伪造HTTP和网络报头中的值，利用此漏洞将数据直接放入报头。党记录服务器变量的查询发送给数据库时，将触发伪造报头中的攻击。

#### 3. 二阶注入

通过用户输入将注入字符串存在数据库里面，只要查询它时，就会触发一个SQLi；引发攻击的输入来自系统本身，这比一阶更加难以防范。

#### 4. Cookie

利用Cookie保存在客户端的浏览器中且使用明文存储（.txt）这一个特性。攻击者可以修改客户端cookie，以便修改SQL查询的结果

#### 5. 物理用户输入

利用条形码、RFID、图像识别的结果注入

### 5.2.2 SQLi攻击类型：带内、推理、带外

#### 带内攻击

- 重言式/永真式攻击

![image-20220628145420065](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220628145420065.png)

- 行尾注释

- 捎带查询

在预期之外添加额外的查询（如上面的DROP table利用了行尾注释和捎带查询）

#### 推理攻击

无实际的数据传输。但是攻击者会获取网页信息推测注入点和服务器的特性进而进行注入。

- 非法/逻辑错误查询

- 盲SQL注入

#### 带外攻击

信息检索使用不同的通信信道

### 5.2.2 SQLi 应对措施

- 防御性编程
- 检测
- 运行时阻断

#### 防御性编程

1. 手动防御型编码实践：对用户的输入进行验证，过滤掉某些有危害的字段，比如不允许输入drop

2. 参数化查询插入：优化SQL查询结构，独立传递值参数

3. SQL DOM：自动验证和转义数据类型

#### 检测

1. 基于签名：匹配特定的攻击模式，不能防范自我修改
2. 基于异常：检测不正常的行为
3. 代码分析：检测SQL漏洞测试集

#### 运行时阻断

在运行时检测查询是否与期望查询一致

## 5.3 数据库访问控制

通过访问控制机制确定用户对数据库的访问权限。一般选择自主访问控制和基于角色的访问控制两类。数据库的访问控制比上一章的操作系统访问控制更加复杂：

- 控制粒度更小：操作系统的粒度文件；数据库的粒度为记录。
- 数据库有关联性：在数据库中可以通过读其他元素的值而推知另一个元素的值，称为推理。操作系统不需要担心推理攻击；而数据库需要合理限制推理攻击。

### 5.3.1 DBMS的管理策略【5.4】

数据库管理系统提供如下管理策略:

1. **集中管理**:少量特权用户可以授予和回收访问权
2. **基于所有权的管理**:表的所有者（创建者）可以授予和回收该表的访问权
3. **分散管理**:表的所有者除了可以授权和回收该表的访问权外，还可以对其他用户授予和回收授权权，以允许他们对该表授予和回收访问权（级联授权）

#### 级联授权 【5.5】

允许访问权通过用户级联授予，即如果用户具有具有授权选项的访问权限，则该用户可以将该权限传递给其他用户，也可以级联收回。

### 5.3.2 基于SQL的访问定义

SQL提供的访问权限：

![image-20220629130948372](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220629130948372.png)

管理访问权的两个命令：

#### GRANT

![image-20220629130904362](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220629130904362.png)

#### REVOKE

![image-20220629131039907](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220629131039907.png)

句末若有CASCADE，表示一并收回级联授权的权限（cascade v倾泻；大量流下n大量，大簇的下垂物）

### 5.3.3 基于角色的访问控制

SQL Server 支持三种类型的角色

- 固定服务器角色
- 固定数据库角色
- 用户定义的角色

## 5.4 推理

#### 推理威胁的本质【5.6】

当多个数据项的组合比单个项更敏感时，或者当数据项的组合可用于推断灵敏度更高的数据时，就会出现推理问题。

简而言之，就是从授权访问的数据中得到非授权数据。

### 5.4.1 两种推理技术

- 分析一个表或多个表的属性之间的函数依赖
- 合并具有相同约束的视图

### 5.4.2 两种处理推理造成信息威胁的方法

- 数据库设计时的推理检测：修改数据库结构、改变访问控制机制
- 查询时的推理检测：在一次查询中检测推理通道，如果发现了就拒绝或修改

这两种方法都需要推理检测算法，这是一个非常复杂和困难的问题。阻塞推理通道有一种方法就是采用如下的SDB

### 5.4.3 统计数据库SDB

SDB的访问控制目标：为用户提供聚集信息而不降低任何单独实体的机密性

在数据库中只存储统计性数据（属性、可能取值，范数），而不是一条条的个人身份信息。

一个SDB的实例：

![image-20220629143003703](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220629143003703.png)

#### 统计数据库的推理

从SDB中获得某些聚集数据，然后推理出单独记录的机密信息称为泄密

**防止推理的方法**

查询限制：查询规模限制、查询集重叠控制、模拟审计

扰动技术：数据扰动、输出扰动

## 5.5 数据库加密

#### 数据库加密的缺点【5.7】

**密钥管理：** 授权用户必须有权访问其有权访问的数据的解密密钥。由于数据库通常可供广泛的 用户和许多应用程序访问，因此向授权用户和应用程序提供数据库选定部分的安全密钥是一项复杂的任务。 

**不灵活性：**当部分或全部数据库被加密时，执行记录搜索变得更加困难。（比如查工资少于100的，加密后则不方便查询）

#### 加密数据库的查询流程

1. 提出查询

   ![image-20220629144555928](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220629144555928.png)

2. 加密密钥k，计算E(k,15)并在数据库中查出Did=E(k,15)

   ![image-20220629144740233](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220629144740233.png)

3. 返回给用户的记录是Did=15

# 第6章 恶意软件

利用计算机漏洞来对计算机系统造成威胁的程序

恶意软件的命名方式：前缀.病毒名.后缀 如：Worm.Sasser.c

### 恶意软件的三种传播机制【6.1】

- 病毒：寄生于可执行代码，通过修改正常程序感染内容并实现自身复制的软件片段
- 蠕虫：独立于其他程序，利用计算机漏洞感染机器，主动寻找并感染其他机器
- 木马：一个表面上看起来有用但内部藏有恶意代码的程序，当被调用时会产生非预期的危害

### 恶意软件的四类有效载荷【6.2】

- 系统损坏：包括数据损坏和物理损坏--数据完整性
- 窃取服务：使其成为攻击代理--系统完整性和可用性
- 信息窃取：键盘记录器、网络钓鱼、间谍软件--机密性
- 隐蔽：后门，rootkit--完整性

## 6.1 恶意软件的分类

#### 按是否依附于宿主程序

- 寄生程序:依附于宿主程序的程序片段，病毒、逻辑炸弹、后门
- 非寄生程序:独立于宿主程序，可被操作系统调度和执行的独立程序，蠕虫、bot程序

#### 按是否进行复制

- 不进行复制:触发执行的程序或程序片段，逻辑炸弹、后门、bot程序
- 进行复制:程序或程序片段，执行时生成一个或多个自身的拷贝，在合适的时机在当前系统或其他系统中被激活，病毒、蠕虫

### 高级持续性威胁APT【6.3】

应用大量入侵技术和恶意软件（高级）的持续性针对目标攻击应用程序。通常来自是一个国家的、商业的组织和部门的攻击。

- 高级：使用各种入侵技术和恶意软件，包括根据需要开发自定义恶意软件。 
- 持续性：对所选目标进行长时间的攻击， 以最大限度地提高成功的机会。 
- 威胁：有组织、有能力且资金充足的攻击者意图破坏特定选择的目标的结果。

## 6.2 病毒

计算机病毒：寄生于可执行代码，通过修改正常程序感染内容并实现自身复制的软件片段

#### 病毒的三个组成部分

- **感染机制(感染向量）：**病毒传播和使病毒能够自我复制的方法
- **【6.10】触发条件（逻辑炸弹）：**是恶意软件中嵌入的代码，当满足某些条件时会触发
- **有效载荷**:病毒除传播之外的活动，包括破坏活动或者无破坏但值得注意的活动

### 病毒生命周期的四个阶段【6.4】

- 潜伏阶段:休眠中。会被某些事件激活。
- 传播阶段:病毒把自身的拷贝插入其他程序或者硬盘上某个与系统相关的区域。病毒拷贝时会变异来逃避检测
- 触发阶段:病毒被激活以执行其预先设定的功能。
- 执行阶段:执行病毒的功能。（可能有害也可能无害)

### 6.2.1 病毒的分类

#### 1. 按破坏性

![image-20220630141019247](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220630141019247.png)

#### 2. 按连接方式/目标

![image-20220630141212226](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220630141212226.png)

#### 3. 按病毒的感染对象分类

![image-20220630141456844](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220630141456844.png)

#### 4. 按躲避和反检测方式分类

![image-20220630142350207](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220630142350207.png)

### 病毒的隐藏手段（4）【6.5】

加密，隐身，多态，变形（解释见上）

### 6.2.2 宏病毒

宏是一个批处理程序命令，完成重复的动作，提高工作效率。

宏病毒是一种寄存在[文档](https://baike.baidu.com/item/文档/1009768)或[模板](https://baike.baidu.com/item/模板/2890455)的宏中的[计算机病毒](https://baike.baidu.com/item/计算机病毒/174112)。一旦打开这样的文档，其中的宏就会被[执行](https://baike.baidu.com/item/执行/3166225)，于是宏病毒就会被激活，转移到计算机上，并驻留在[Normal模板](https://baike.baidu.com/item/Normal模板)上。从此以后，所有自动保存的文档都会“感染”上这种宏病毒，而且如果其他用户打开了感染病毒的文档，宏病毒又会转移到他的[计算机](https://baike.baidu.com/item/计算机/140338)上。--百度百科

电子邮件、word文档，Adobe PDF

### 机器可执行病毒和宏病毒的区别【6.6】

机器可执行病毒：感染*可执行*文件的病毒，它通常隐藏在宿主程序中，执行宿主程序时，将会先*执行病毒*程序。通常以特定方式针对操作系统或硬件平台工作。

宏病毒：感染含有由应用程序解释的可执行宏代码或脚本语言的**文件**，被感染的宏执行后就会驻留在计算机内。

## 6.3 蠕虫

蠕虫利用计算机漏洞，能够自我复制，独立于宿主程序，通过网络大量传播并自身拷贝的恶意代码。

#### 蠕虫的特征

- 蠕虫多数是利用系统漏洞或电子邮件系统进行传播。
- 由于蠕虫是一种独立程序，所以它们也可以作为病毒的寄生体，携带病毒，并在发作时释放病毒，进行双重感染。
- 病毒防治的关键是将病毒代码从宿主文件中摘除，蠕虫防治的关键是为系统打补丁(patch），而不是简单地摘除。只要漏洞没有完全修补，就会重复感染。

#### 蠕虫与病毒的区别

蠕虫通过网络传播；病毒可以通过任何介质传播

蠕虫自身拷贝都是以独立程序的形式传播；病毒的自身拷贝必须嵌入到其他程序中

#### 蠕虫的防范

1. 基于特征码的蠕虫扫描过滤
2. 基于过滤的蠕虫围堵策略
3. 基于净载分类的蠕虫围堵策略
4. 阈值随机行走扫描检测
5. 速率限制和速率阻断

### 6.3.1 蠕虫

### 蠕虫访问远程系统/传播方法【6.7】

1. 电子邮件或即时通信工具:通过邮件将拷贝发送到其他系统中当邮件附件被打开或邮件被浏览时，蠕虫代码执行。
2. 文件共享:蠕虫可以在如USB设备等可插拔媒介上创建自己的拷贝或感染上面的文件。当此设备插入其他系统时，蠕虫可以借助软件漏洞或被感染文件执行。
3. 远程执行能力:通过直接的远程执行工具，或通过在网络服务上产生一个溢出暗中执行操作。
4. 远程文件访问或传输能力:利用远程文件访问或者传输服务向其他系统复制自身的拷贝，该系统的用户以后可能执行它。
5. 远程登录能力:以一个用户身份登录到远程系统，然后使用命令将自己拷贝到另一系统中

### 蠕虫传播的四个阶段【6.4】

- 潜伏阶段

- **传播阶段**

  ![image-20220630143120150](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220630143120150.png)

- 触发阶段

- 执行阶段

#### 蠕虫程序的功能结构

- 传播模块：扫描、攻击、复制
- 隐藏模块
- 目的模块

### 6.3.2 蠕虫的扫描机制

扫描策略：随机选取一段IP地址，然后对这一地址段上的主机进行扫描。数量一旦增大，网络上就会有大量的扫描包造成网络拥塞，很容易被探测到。

扫描策略改进：尽量减少重复的扫描：限制次数、分散时间、分散位置

### 6.3.3 蠕虫的隐藏手法

- 修改蠕虫在系统中的PID和进程名称，掩盖启动时间
- 更换文件名为已经运行的服务
- 删除自己

### 6.3.4 蠕虫的现状

- 多平台
- 多攻击手段
- 超快传播
- 多态
- 变形
- 传输载体
- 0-day攻击

### 6.3.5 手机蠕虫

蓝牙、彩信、智能手机

最多的还是通过含有木马的APP植入手机的

### 6.3.6 移动代码

不加修改就能在不同系统平台上运行并实现相同功能的程序。

常见的载体有Java applet、JavaScript、ActiveX

### 6.3.7 路过式下载【6.8】

利用浏览器漏洞，因此当用户查看由攻击者控制的网页时，用户在不知情或未经同意的情况下在系统上下载和安装恶意软件的代码。

它不像蠕虫那样主动传播，而是**等待无防备的用户访问恶意网页来传播**（蠕虫）。

### 6.3.8 点击劫持/用户界面伪装攻击

攻击者使用一个透明的iframe覆盖在网页上，诱使用户在该页面上进行点击。

## 6.4 木马【6.9】

特洛伊木马：表面上有某种其他功能的程序，内部藏有恶意代码。完整的木马由两部分组成：服务器程序（被攻击者）&控制器程序（攻击者）

传播形式：手工放置、电子邮件附件、文件传输、诱导打开、捆绑在其他程序上

## 6.5 隐蔽：rootkit、后门

### 【6.11】概念区分

**后门**是程序或系统的秘密入口点，允许知道后门的人在不经过通常的安全访问过程的情况下获得访问权限。

**机器人**破坏受感染系统的计算和网络资源，供攻击者使用。 

**键盘记录程序**捕获受感染计算机上的击键，以允许攻击者监视敏感信息，包括登录名和密码凭据。 

**间谍软件** 破坏受感染的机器，以允许监视系统上的各种活动，

**rootkit** 是安装在系统上用于维护对具有管理员（或 root）权限的系统的隐蔽访问的一组程序，同时最大程度地隐藏其存在的证据。

### 【6.13】rootkit分类p148

## 6.6 信息窃取：键盘记录器、网络钓鱼、间谍软件

### 【6.12】

**网络钓鱼**攻击使用垃圾邮件来利用社会工程来利用我们的信任，伪装成来自受信任来源的通信，这可能会将用户定向到虚假网站，或者填写某些封闭的形式并在攻击者可以访问的电子邮件中返回。

鱼叉式网络钓鱼攻击。攻击者会仔细研究收件人，并且每封电子邮件都经过精心设计以专门适合其收件人，通常引用一系列信息以使其确信其真实性。这大大增加了收件人按照攻击者的要求进行响应的可能性。

## 6.7 对抗手段

### 预防措施（3）+环境措施（3）【6.14】p150

### 反病毒软件部署位置（3）【6.15】

反病毒软件的首要部署位置是各个终端系统。给予反病毒软件最大的权限收集恶意软件在系统上运行的程序的执行和行为

反病毒软件部署的第二个位置是防火墙和入侵检测系统。……

反病毒软件部署的第三个位置是分布式配置。……

### 四代反病毒软件【6.16】22年考了p151

# 第7章 拒绝服务攻击

#### DOS定义【7.1】

DOS攻击是一种通过耗尽CPU、内存、带宽以及磁盘空间等系统资源，来阻止或削弱对网络、系统或应用程序的授权使用的行为。

## 7.1 拒绝服务攻击

### 7.1.1 DoS攻击的本质

#### DOS攻击对象【7.2】

- **网络带宽**：针对网络带宽的DoS攻击主要有计算机网络**带宽攻击和连通性攻击**。
  1. 带宽攻击指以极大的通信量冲击网络，使得所有可用网络资源都被消耗殆尽，最后导致合法的用户请求无法通过。
  2. 连通性攻击指用大量的连接请求冲击计算机，使得所有可用的操作系统资源都被消耗殆尽，最终计算机无法再处理合法用户的请求。
- **系统资源**：
  1. 通过过度加载或者使系统网络处理程序崩溃而实现攻击。【SYN欺骗】
  2. 使用某些特殊的数据包来触发系统的处理缺陷，导致系统崩溃。【有毒数据包，死亡ping，泪滴攻击】
- **应用资源**：大量合法的高代价处理请求【cyberslam攻击】

#### 死亡之PING-ICMP攻击

**ping**是Packet Internet Groper(因特网包探索器）的缩写，是应用层协议，基于ICMP，不使用TCP或UDP。因此ping工作在网络层。

Ping命令可以检测计算机的网络问题

1. 如果ping 127.0.0.1失败，就表明本地机TCP/IP协议不能正常工作。
2. 如果ping本机地址失败，则网络协议有问题
3. 如果ping一个与自己在同一网段的IP地址失败，表明网络适配器（网卡、MODEM等）出现故障，或对方不在线
4. 如果ping目标机的IP地址成功，但ping目标机的网络名失败，则说明DNS服务出现问题。
5. 如果ping自己的网关失败，则说明本机配置的网关有问题。
6. 如果ping localhost失败，则本机的host文件存在问题。
7. ping 0.0.0.0得不到回应，无效地址

ping of death 就是一直发送超出合法长度（65535）的ping包致使对方内存溢出最终崩溃,for eg：

**ping -l 65500 192.168.0.102 -t**

#### Tear Drop attack

发送伪造的相互重叠的IP分组数据报，使接收主机难以组合，最终主机因此而死机或瘫痪。泪滴攻击的危害性不被认为是严重性的。

#### Local Area Network Denial attack

LAND攻击：特别构造的TCP SYN数据包，使得目标机器开启一个源地址与目的地址均为自身IP地址的空连接，持续的自我应答，消耗资源直至崩溃

#### 源地址欺骗

在数据包中填入虚假的地址，以达到隐蔽的目的

#### 反向散射流量【7.6】

“**反向散射流量**”是由于虚假源地址的使用，使得响应数据包以发散方式传播到网络上。

使用目标地址为目标的伪造随机源地址的任何 DoS 攻击的信息，包括各种单一和分布式泛洪攻击以及 syn 欺骗攻击。不提供不使用随机伪造源地址的攻击的信息，也不提供有关伪造源地址是所需目标的反射或放大攻击的信息。

#### 放大攻击/僵尸主机

在网络中控制许多僵尸主机同时攻击目标主机

#### SYN欺骗（不是SYN洪泛攻击）

攻击目标：TCP连接表

利用TCP建立连接三次握手的特性，以虚假的源地址发送大量的半连接请求，使得服务器上用于管理TCP连接的连接表溢出，从而攻击网络服务器响应TCP连接请求的能力。

## 7.2 洪泛攻击：最简单经典的DOS攻击

flooding：洪泛 

在网络拥塞中，合法有用的数据包会大量丢失，导致服务不可用。

#### 洪泛攻击攻击目的【7.3】

1. 使到服务器的某个链路超负荷
2. 使服务器处理和响应的能力超负荷。

通常结合源地址欺骗或放大攻击

#### 洪泛攻击常用数据包【7.4】

几乎任何类型的网络数据包都可以用于泛洪攻击。常见：ICMP数据包、TCP SYN数据包、UDP数据包、IP数据包

### 7.2.1 ICMP洪泛

攻击者生成大量虚假源地址的错误的数据包，（如目的不可达和超时）

### 7.2.2 UDP洪泛

UDP限制很少，实现成本较低。几乎所有端口都可以攻击。

### 7.2.3 TCP SYN洪泛

#### SYN欺骗与SYN洪泛的区别

SYN欺骗的攻击对象是TCP连接表，只会影响服务器建立TCP连接的能力。

SYN洪泛的攻击对象是数据包总量，会使服务器的链路超负荷或处理能力超负荷。

#### 防范TCP SYN欺骗攻击【7.13】

1. 通过使用TCP连接改进版本来防御SYN欺骗攻击。

​	不是将连接详细信息保存在服务器上，而是在作为服务器的初始序列号发送的“**cookie**”中编码关键信息。当合法客户端使用 ACK 数据包进行响应时，服务器能够重建此信息 。通常，仅当表溢出时才使用此技术，因为它会占用服务器上的计算资源，并且还会阻止使用某些 TCP 扩展。 

2. 修改TCP/IP网络处理程序中所使用的参数。

   TCP连接表大小、删除表项超时计时器，以此管理最大连接请求率。

## 7.3 分布式拒绝服务攻击

#### DDOS定义【7.7】

攻击者入侵其他主机系统组成僵尸机网络，从而利用它们发动攻击性更强、更加隐蔽拒绝服务攻击。

好处：1. 攻击性更强 2. 攻击者更加隐蔽 3. ICMP、UDP、TCP洪泛可同时进行

#### DDOS攻击的体系结构【7.8】

![image-20220726155704000](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220726155704000.png)

分布式拒绝服务 （DDoS） 攻击僵尸网络通常使用控制层次结构，其中少数系统充当处理程序，控制大量代理系统。攻击者可以向处理程序发送单个命令，然后处理程序自动将其转发到其控制下的所有代理。

#### 多机系统攻击的三种方式

- 分布式拒绝服务攻击 DDoS
- 反射攻击
- 放大攻击

## 7.4 基于应用的带宽攻击

### 7.4.1 SIP洪泛

SIP：IP语音电话控制协议。

两种攻击方法

1. 攻击者通过发送大量的INVITE消息到SIP服务器，导致被攻击SIP服务器分配大量的资源用以记录和跟踪会话，直到资源耗尽而无法响应合法用户的呼叫请求;
2. 针对VoIP设备在SIP协议实现上的漏洞构造并发送相应的畸形SIP报文，从而导致SIP服务器拒绝服务。

### 7.4.2 基于HTTP的攻击



## 7.5 反射攻击和放大攻击

任何常用的UDP服务都可以用来进行反射攻击。

### 7.5.1 反射攻击【7.9】

攻击者将目标的地址作为数据包的源地址向许多服务器发送大量此类欺骗性请求 ，产生的响应洪流可能会使目标的网络链接不堪重负。

特点：1. 普通的服务器系统被用作中介，并且它们对数据包的处理完全是正常合规的；

2.  更容易部署，并且更难追溯到实际的攻击者；
3. 没有反向散射流量

### 7.5.2 放大攻击【7.10】

放大攻击是反射攻击的一个变种。攻击者将目标系统的地址作为数据包的源地址发送给中间媒介，**中间媒介对每个原始数据包生成多个响应数据包**。

攻击方式：通常是通过将原始请求定向到某些网络的广播地址，那么该网络上所有主机都会对数据包中的源地址响应。

#### DNS放大攻击

是将**DNS服务器**作为中间媒介系统，使用直接指向合法DNS服务器的数据包进行攻击，利用DNS协议生成比原始请求大得多的响应数据包。 

#### 防御措施【7.14】

同样地，针对 DNS 放大攻击的基本防御措施是防止使用欺骗性源地址。

这种过滤需要通过路由器或网关知道传入数据包的有效地址范围，**尽可能靠近数据包源头** 。通常应用于数据包离开 ISP之前，甚至在网络应用的入口点处。

## 7.6 拒绝服务攻击防范

#### 四道防线【7.11】

- 攻击前:攻击预防和先发制人机制
- 攻击时:攻击检测和过滤
- 攻击时和攻击后:攻击源回溯和识别
- 攻击后:攻击反应

许多DoS 攻击的关键都是使用虚假的源地址，因此DOS的**根本防御措施**是<u>防止源地址欺骗</u>。

#### 非欺骗性泛洪攻击【7.12】

非欺骗性泛洪攻击最好通过足够大的网络带宽和复制的分布式服务器来防御；对流量施加各种类型的速率限制。但不能彻底防御。

#### 【**7.15**】

为防止组织的系统在广播放大攻击中被用作中介，最好的防御措施是阻止使用IP定向广播。这可以由ISP完成

#### 【7.17】DoS攻击的应对措施（已被攻击）

当检测到拒绝服务攻击时，最重要的步骤是确定攻击的类型，从而确定防御攻击的最佳方法。数据包的捕获、分析、寻找攻击数据包的类型。在无法恢复正常工作时，组织可以切换到备用备份服务器，或者快速调试具有新地址的新站点上的新服务器，以便恢复服务。 

# 第8章 入侵检测

最受公众关注的两个安全威胁：入侵者、病毒

## 8.1 入侵者

#### 四类入侵者【8.1】

•   **网络犯罪分子** 是有组织犯罪集团的个人或成员，其目标是经济奖励; 

•   **活动家**：要么是个人，通常是内部人士，要么是受社会或政治原因驱使的更大的攻击者团体的成员;

•   **国家赞助的组织**：是由政府赞助的黑客团体，用于进行间谍或破坏活动。它们也被称为**高级持续性威胁（APT）**，因为这种隐蔽的性质和长期存在，涉及此类中的许多攻击; 

•   **其他人**：是具有上述动机以外的动机的黑客，包括受技术挑战或pe-er群体尊重和声誉驱动的经典黑客或破解者。

#### 入侵者在攻击系统时通常使用的步骤是【8.2】

•   **目标获取和信息收集**：攻击者使用公开可用的技术和非技术信息识别和表征目标系统，并使用网络探索工具映射目标资源; 

•   **初始访问**：通常通过利用远程 network 漏洞，通过猜测远程服务中使用的弱身份验证凭据，或者通过使用某种形式的社会工程或下载驱动攻击在系统上安装恶意软件; 

•   **权限提升**：是在系统上执行的操作，通常通过本地访问漏洞来增加攻击者可用的权限，以在目标系统上实现其预期目标; 

•   **信息收集或系统利用**：是攻击者访问或修改系统上的信息 或资源，或导航到另一个目标系统的操作; 

•   **维护访问**：是诸如安装后门或其他恶意软件，或向系统添加隐蔽的身份验证凭据或其他配置更改等操作 ，以使攻击者在初始攻击后能够继续访问。 

•   **覆盖跟踪**：攻击者禁用或编辑审核日志以删除攻击活动的证据，并使用 rootkit 和其他措施隐藏秘密安装的文件 或代码 

#### 攻击实例【8.3】p179 表8-1

## 8.2 入侵检测系统 Intrusion Detection System

IDS防范内外部攻击，IDS = 网络监控

### 8.2.1 入侵检测

定义:一种监控并分析系统事件的安全服务，目标是发现未经授权而访问系统资源的尝试活动，并提供实时或近似实时的报警。

基本目的:检测入侵，记录可疑事件，并发送警报。

#### IDS分类【8.5】

1. **基于主机的 IDS：** 监视单个主机的特征以及该主机内发生的事件是否存在可疑活动

2. **基于网络的IDS：** 监控特定网段或设备的网络流量，并分析网络，传输和应用程序协议以识别可疑活动

3. **分布式或混合IDS**：将来自多个传感器（通常是基于主机和网络的）的信息组合到一个中央分析仪中，该分析仪能够更好地识别和响应入侵活动。

#### IDS三个逻辑组件【8.4】

**传感器**：

- 负责收集数据
- 输入类型:网络数据包、日志文件、系统调用迹分析器

**分析器**：

- 从一个或多个传感器或其他分析器接收输入
- 负责确定是否发生了入侵
- 提供指导，用于判定什么活动是入侵导致的后果用户接口

**用户接口**：

- 通过用户接口，用户查看系统输出

### 8.2.2 基本原理

身份认证、访问控制和防火墙在阻断入侵方面都起到了一定的作用。但

#### 使用IDS的原因/IDS的三个优点【8.6】

1.如果能快速地检测到入侵，就可以在损害发生或者数据受到威胁之前，将入侵者识别出来并将其逐出系统。即使未能及时地检测出入侵者，但越早检测到入侵，则对系统造成的损失越小，而且越容易进行快速的恢复。
2.有效的IDS可以作为一个威慑，从而达到阻止入侵的目的。
3.人侵检测可以收集关于入侵技术的信息，用于增强入侵防御系统的防护能力。

#### IDS的折中使用/基率谬误【8.7】【8.8】

**误报**或误报是指 IDS 将授权用户标识为入侵者。

**漏报**是指入侵者未被 IDS 标识为入侵者

基率谬误：当基本比率较低时，很难同时满足高检测率和低误报率。

解释：

尽管入侵者的典型行为与授权用户的典型行为不同，但这些行为间仍有重叠部分。

因此，如果对人侵者行为的定义过于宽松，虽然能够发现更多的入侵者，但是也容易导致大量的误报( false positive)，或者虚假警报,即将授权用户误认为入侵者。

相反，如果为了减少误报而对入侵者行为的定义过于严格，这将导致漏报( false negative)增加，可能漏过真实的人侵者。

（联想假设检验的弃真和纳伪）

#### 理想的IDS满足【8.9】

​    •在最少的人工监督下持续运行。 

​    •具有容错能力，因为它必须能够从系统崩溃和重新初始化中恢复。

​    •抵制颠覆。IDS 必须能够监视自身并检测它是否被攻击者修改。

​    •对运行它的系统施加最小的开销。 

​    •能够根据正在监视的系统的安全策略进行配置。 

​    •能够适应系统和用户行为随时间的变化。 

​    •能够扩展以监控大量主机。 

​    •提供正常的服务降级，因为如果 IDS 的某些组件因任何原因停止工作，则其余组件应尽可能少地受到影响。 

​    •允许动态重新配置;也就是说，无需重新启动 IDS 即可重新配置 IDS。 

## 8.3 分析方法

#### IDS分析方法【8.10】

1. **异常检测**涉及在一段时间内收集与合法用户行为相关的数据。然后将统计测试应用于观察到的行为，以高度自信地确定该行为是否不是合法的用户行为。 
2. **特征或启发式检测**使用一组已知的恶意数据模式（特征）或攻击规则（启发式）与当前行为进行比较，以确定是否为入侵者的行为。它也被称为误用检测。此方法只能识别具有模式或规则的已知攻击。

### 8.3.1 异常检测：基于行为

依据合法用户的行为规则（用户轮廓）来判定用户行为的不合法性

**阈值检测**:为各种事件（I/O利用率、文件访问次数等）发生的频率定义阈值，与具体用户无关

**基于配置文件的检测**:为每个用户建立一个活动配置文件，检测单个账户行为变化。

![image-20220702132618090](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702132618090.png)

#### 异常检测分类方法【8.11】

•   **统计**：使用观测指标的单变量、多变量或时间序列模型分析观察到的行为。

•   **基于知识**：方法使用专家系统，该系统根据 一组对合法行为进行建模的规则对观察到的行为进行分类。

•   **机器学习**：方法使用数据挖掘技术自动从训练数据中确定合适的分类模型。

#### 异常检测常用机器学习方法【8.12】

•   **贝叶斯网络**：对观察到的指标之间的概率关系进行编码。 

•   **马尔可夫模型**：开发一个具有状态集的模型，其中一些可能是隐藏的，通过转移概率相互连接。

•   **神经网络**： 用神经元和它们之间的突触模拟人脑操作，对观察到的数据进行分类。

•   **模糊逻辑**：使用模糊集合论，其中推理是近似的，并且可以容纳不确定性。

•   **遗传算法**：使用受进化生物学启发的技术， 包括遗传，突变，选择和重组，来制定分类规则。

**聚类和异常值检测**：根据某些相似性或距离度量将观测到的数据分组到聚类中，然后将后续数据标识为属于聚类或异常值。 

### 8.3.2 特征或启发式检测/误用检测：基于事件

总结网络攻击的特征，简称数据库。根据一组规则或攻击模式，确定给定的行为是否为入侵者行为。如：端口扫描

![image-20220702132524631](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702132524631.png)

### 8.3.3 特征&启发 区别【8.13】

**特征检测** 将大量已知恶意数据模式的集合与存储在系统上或通过网络传输的数据相匹配。 

**启发式识别** 涉及使用规则来识别已知渗透或将利用已知弱点的渗透。还可以定义规则来识别可疑行为，即使该行为在既定的使用模式的范围内。

#### 适合特征检测的攻击

1. **应用层侦查和攻击**:应用层协议、数据库协议、即时消息应用、对称文件共享软件、缓冲区溢出、口令猜测等传输层侦查和攻击:异常数据包碎片、易受攻击端口扫描、TCP特定攻击
2. **网络层侦查和攻击**:IPv4、IPv6、ICMP、IGMP，非法IP头部及源地址欺骗
3. **意外应用程序服务**:NIDS试图确定传输连接上的活动是否与预期的应用协议一致
4. **策略违背**:使用不当的Web站点和使用禁用的的应用协议

#### 适合异常检测的攻击

1. **拒绝服务攻击**:会显著提高数据包流量，或者显著增加尝试连接次数
2. **扫描**:攻击者通过发送不同种类的数据包探测目标网络或系统。通过标题抓取（应用层）、TCP和UDP端口扫描、ICMP扫描的非典型流量模式可以测到扫描攻击
3. **蠕虫**:某些蠕虫快速传播并占用大量带宽，或导致通常不通信的主机发生了通信，或导致主机使用通常不用的端口，或执行扫描操作，因此可以被检测到

**状态协议分析**(SPA):通过推断和追踪网络层、传输层、应用层协议的状态，保证网络活动与其发展。缺点在于资源占用过高。

## 8.4 基于主机的入侵检测系统 HIDS

运行在单个工作站、客户端或主机上，检测的是主机上的用户和软件活动

检测内容：从系统运行所在的主机获取审计数据（比如系统日志、系统状态信息、运行程序的行为特征、文件变更情况），保护目标是系统所在的主机

特点:能准确知道目标系统发生的事件，但运行时占用系统资源（(CPU容量的5%~15%)

优点：可以检测内部和外部入侵（NIDS则不行）

#### HIDS数据源【8.14】

![image-20220702133700826](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702133700826.png)

### 8.4.2 异常HIDS

![image-20220702133253392](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702133253392.png)

### 8.4.3 特征或启发式HIDS

广泛使用，尤其常见于反病毒程序（A/V)中。移动设备上也非常普遍地使用。
被纳入防火墙和基于网络IDS中的邮件和Web应用代理中。
优点:能够非常高效地检测**已知**恶意软件。
缺点:没有能力检测无相关特征或启发式规则地**0-day攻击**。



## 8.5 基于网络的入侵检测系统 NIDS

![image-20220702133555127](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702133555127.png)

#### NIDS传感器类型【8.17】

**内嵌传感器**插入到网段中，以便它所监视的通信量必须通过该传感器。如局域网交换机、防火墙

缺点：可能造成数据包延迟

**被动传感器**监视网络通信量的副本;实际通信量不会通过设备。通过物理分接器连到网络上，有网卡 MAC地址，不分配IP地址，但有IP地址的接口可能与管理员通信

![image-20220702133831321](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702133831321.png)

#### NIDS 传感器四个位置【8.18】p189 各位置优缺点

1. 在外部防火墙内部; 
2. 在外部防火墙和互联网或广域网之间; 
3. 在主要骨干网络的入口处; 
4. 在工作站局域网上。

## 8.7 分布式或混合式入侵检测系统【**8.15**】【8.20】

分布式HIDS通过 **跨网络的HIDS之间的协调和协作**，提供更有效的防御。 

分布式或混合 IDS 在中央 IDS 中组合在一起，HIDS 使用的补充信息源具有基于主机的流程和数据详细信息，NIDS 与网络事件和数据相结合，以管理和协调组织 IT 基础架构中的入侵检测和响应。

## 8.8 蜜罐

蜜罐 是诱饵系统，旨在引诱潜在攻击者远离关键系统。 
把攻击者引导到一个经过特殊装备的系统上，这种系统被成为蜜罐。实际上是入侵诱骗系统，一般不会主动对外发起通信，除非入侵者进入。

#### 功能

- 转移攻击者对重要系统的访问
- 收集有关攻击者活动的信息
- 鼓励攻击者在系统中逗留足够长的时间，以便于管理员对此攻击做出响应

#### 分类

- **低交互蜜罐**:由能够模拟特定IT服务或系统的软件包构成，能提供一种真实的初级交互，但无法提供所模拟的服务或系统的全部功能
- **高交互蜜罐**:具有完整操作系统、服务以及应用程序的真实系统，被部署在攻击者能够访问的地方

#### 部署

![image-20220702134822102](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702134822102.png)

# 第9章 防火墙和入侵防御系统

#### 防火墙定义

一种用来加强网络之间访问控制、防止外部网络用户以非法手段通过外部网络进入内部网络、访问内部网络资源，保护内部网络操作环境的特殊网络互连设备。

防火墙会依照特定的规则，允许或是限制传输的数据通过。

防火墙可以是一台专属的硬件也可以是架设在一般硬件上的一套软件。

## 9.1 防火墙的特征和访问策略

### 9.1.1 防火墙的设计目标【9.1】

1. 所有入站和出站的网络流量都必须通过防火墙。
2. 只有经过授权的网络流量才允许通过防火墙。
3. 防火墙本身不能被渗透，应该运行在有安全操作系统的可信系统上。

### 9.1.2 防火墙的访问策略【**9.2**】

1. **IP** **地址和协议值**：根据源或目标地址和端口号、流入或出站的流向以及其他网络和传输层特征来控制访问。 -- 包过滤、状态检测
2. **应用协议**：根据授权的应用协议数据控制访问。-- 应用层网关
3. **用户标识**：根据用户标识控制访问，通常适用于使用某种形式的安全身份验证技术（如 IPSec）标识自己的内部用户。 
4. **网络活动：**根据时间或请求或其他活动模式等注意事项控制访问。

#### 防火墙的作用

- 对企业内部网实现集中安全管理，强化网络安全策略，比分散的主机管理更经济易行。
- 作为部署**网络地址转换NAT的地点**，缓解地址空间短缺,隐藏内部网的结构
- 是审计和记录网络访问最佳的地方。

#### 防火墙的局限性

- 可能带来用户使用不便，如限制或关闭一些有用但存在安全缺陷的网络服务;带来传输延迟、瓶颈及单点失效等。
- 不能防范内部攻击
- 不能防止旁路攻击：绕开防火墙的攻击

## 9.2 防火墙的类型

#### 从防火墙技术分

- 包过滤防火墙
- 状态检测防火墙
- **代理服务器充当防火墙**

#### 从软、硬件形式上分

- 硬件防火墙：软件固化
- 软件防火墙

### 9.2.1 包过滤防火墙

处理速度快、**静态包过滤**、用户透明、易于维护

网络层工作，检查进出两方向的每个数据包的包头信息进行比较，决定转发还是丢弃。在筛分路由器上实现，实际上是一种网络层的访问控制。

#### 包过滤FW过滤规则使用的信息【**9.2**】

过滤规则基于IP、TCP、UDP、ICMP的**包内信息**配置

1. **源 IP 地址：** 发起 IP 数据包的系统的 IP 地址。 
2. **目标 IP 地址：** IP 数据包尝试访问的系统的 IP 地址。 
3. **源和目标传输级地址：** 传输级（例如 TCP 或 UDP）端口号，它定义了 SNMP 或 TELNET 等应用程序。 
4. **IP** **协议字段：** 定义传输协议。 
5. **接口：** 对于具有三个或更多端口的路由器，数据包来自路由器的哪个接口或数据包发往路由器的哪个接口。

#### TCP过滤原理

![image-20220702151244422](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702151244422.png)

举例：telnet端口为23

![image-20220702151319779](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702151319779.png)

![image-20220702152246002](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702152246002.png)

#### 攻击方式及应对

![image-20220702153657605](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702153657605.png)

#### 包过滤FW缺陷【9.4】  

**1.** 由于包过滤防火墙**不检查上层数据**，因此**无法阻止利用应用程序的漏洞或功能**的攻击。

**2.** 由于包过滤防火墙只检查包头信息，包过滤防火墙中存在的**日志记录功能受到限制**。（源地址、目标地址和流量类型）。 

**3.** 大多数包过滤防火墙**不支持高级用户身份验**证方案。同样，这种限制主要是由于防火墙缺乏上层功能。 

**4.** 包过滤防火墙**无法检测到网络层地址信息**是否改变。入侵者通常使用**地址欺骗攻击**来绕过防火墙平台中实施的安全控制。

**5.** 最后，由于访问控制决策中使用的变量数量很少，数据包过滤器防火墙容易受到配置不当引起的安全漏洞的影响。  

### 9.2.2 状态检测FW

**动态包过滤**，用户透明性、更高安全。工作在网络层。

#### 状态连接表

它将属于同一连接的所有包作为一个整体的数据流看待(保证了前后报文的相关性），构成连接状态表。通过**规则表与状态表的共同配合**，对数据包进行转发或拒绝处理。

#### 状态检测流程

- 它使用了一个在网关上执行网络安全策略的软件模块，称之为监测引擎。
- 对新建的应用连接，**检查预先设置的安全规则**，允许符合规则的连接通过，并在内存中记录下该连接的相关信息，生成连接记录。
- 对该连**接的后续数据包，只要符合状态表，就可以通过**，而不需进行规则检查，在一定程度上使性能有较大提高。

#### UDP过滤原理

将流入的UDP数据包与流出的UDP数据包动态匹配，看发来的包的源端口和地址是否与刚才流出的目的端口和地址相同

#### 状态检测&包过滤【9.5】

**传统的数据包过滤器**基于单个数据包做出过滤决策，并且不考虑任何更高层的上下文信息。它允许所有高端口号的TCP流量通过。

**状态检查数据包筛选器** 通过创建出站 TCP 连接目录来强制执行 TCP 流量的规则。每个当前建立的连接都有一个条目，只有符合要求的数据包才能通过。

### 9.2.3 代理服务器

代理都不允许端到端的TCP连接

#### 定义【9.6】【9.7】

![image-20220702153740842](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702153740842.png)

#### 代理实现的基本过程

1. 设置用户验证和记账（统计）
2. 对用户进行分级
3. 连接内网和Internet，充当防火墙。内部主机对外可以隐藏自己的信息
4. 增加cache，提高热门站点访问速度

![image-20220702153835418](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702153835418.png)

#### 代理服务器的优点

- 代理服务器理解应用协议，它针对特定的应用协议使用指定的数据过滤逻辑。
- 根据协议内部可见的内容而不仅仅根据头部数据来控制穿越防火墙的行为;
- 安全性高，可防止在受信主机与非受信主机间直接建立联系。

#### 代理服务器的不足

- 每个特定的应用( www、FTP、E-mail）都需要一个专门的代理，扩充性差，使用时工作量大，效率低，在网络上运行一个代理服务器可能需要更昂贵的硬件;
- 首先它会使访问速度变慢，因为不允许用户直接访问网络。

### 9.2.4 四种防火墙区别（定义+TCP处理方式）【9.8】

​    **数据包筛选防火墙：** 对每个传入和传出 IP 数据包应用一组**静态**规则，然后转发或丢弃该数据包。 

​    **Stateful** **检查防火墙：** 通过创建出站 TCP 连接目录来强制执行 TCP 流量规则。每个当前建立的**动态**连接都有一个条目，仅允许 那些符合此目录中某个条目的配置文件的数据包的传入流量进入高编号端口。

​    **应用程序代理防火墙：** 充当应用程序级流量的中继。用户使用 TCP/IP 应用程序（如 Telnet 或 FTP）与网关联系，网关要求用户输入要访问的远程主机的名称。当用户响应并提供有效的用户 ID 和身份验证信息时，网关会联系远程主机上的应用程序，d 会中继包含两个端点之间应用程序数据的 TCP 段。如果网关未为特定应用程序实现代理代码，则该服务不受支持，并且无法通过防火墙转发。此外，可以将网关 配置为仅支持网络管理员认为可接受的应用程序的特定功能，同时拒绝所有其他功能。

​    **电路级代理防火墙：** 与应用程序网关一样，电路级网关不允许 端到端 TCP 连接;相反，网关设置两个 TCP 连接，一个在自身与内部主机上的 TCP 用户之间，另一个在自身与外部主机上的 TCP 用户之间。建立两个连接后，网关通常会将 TCP 段从一个连接重新连接到另一个连接，而无需检查内容。安全功能包括确定将允许哪些连接。 

![image-20220731141838871](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220731141838871.png)

## 9.3 防火墙的布置

### 9.3.1 堡垒主机【9.9】

- 堡垒主机可以作为应用级网关（应用代理）的平台
- 堡垒主机的硬件平台上运行操作系统的安全版本，使其成为可靠系统
- 只安装基本服务，比如DNS, FTP, HTTP,SMTP
- 堡垒主机中，每个代理都是独立的。若某个代理有问题或漏洞，可以卸载，不影响其他代理应用程序运行。若要支持一个新服务，则直接安装

### 9.3.2 基于主机的防火墙

是一个用于保障个人主机安全的软件模块，一般是系统自带的或作为附件出现。
通常位于服务器上

#### 优点【9.10】

1. 过滤规则**可根据主机环境进行定制**。可以实现服务器的特定企业安全策略，为不同应用程序的服务器使用不同的筛选器。
2. **保护独立于拓扑**结构。因此，**内部和外部攻击都必须通过防火墙**。 
3. 与独立防火墙结合使用时，基于主机的防火墙提供了额外的保护层。一种新型的服务器可以添加到网络中，具有自己的防火墙，而无需更改网络防火墙配置。 

### 9.3.3 网络设备防火墙

通常在网络设备中提供监事和过滤通过设备的数据包流

### 9.3.4 DMZ网络【9.11】

#### 【9.12】

**外部防火墙**位于本地或企业网络的边缘，就在连接到 Internet 或某些广域网 （WAN） 的边界路由器内。

**内部防火墙**负责企业内部网络。

#### 【9.11】

位于内部防火墙和外部防火墙之间的区域，其中的一个或多个网络设备形成的网络，称为非军事区DMZ

DMZ 中部署的系统需要外部连接，如公司网站、电子邮件服务器或 DNS（域名系统）服务器。

![image-20220702155340033](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220702155340033.png)

## 9.4 入侵防御系统 Intrusion Prevention System 

### IPS&IDS&防火墙

1. IPS是IDS的扩展
2. IDS侧重于检测恶意行为，防火墙侧重于阻止流量。IPS 会像防火墙一样阻止流量，且利用为算法决定如何防御**【9.13 IPS和防火墙区别】**
3. IPS的部署完全类似于IDS的部署。IPS可以是基于主机的、基于网络的，也可以是分布式/混合的**【9.14 IPS如何部署】**
4. 在IPS 检测到恶意活动时，它可以通过修改或阻止跨外围或进入主机的网络数据包，或者通过修改或阻止主机上运行的程序的系统调用来响应。**【9.15 IPS如何阻止】**

### 解释UTM p219 【9.16】

UTM执行网络防火墙，网络桁架检测和预防以及网关防病毒。 

# 第10章 缓冲区溢出

#### 缓冲区

用户为程序运行时在计算机内申请的一段连续内存。在一些高级语言中，缓冲区是在堆栈上进行的。高速部件和低速部件协调工作，将高速部件的输出暂存到缓冲区。

### 缓冲区溢出定义【10.1】

缓冲区溢出是指接口的一种状况，此时**大量的输入被放置到缓冲区或者数据存储区，超过了其所分配的存储能力，覆盖了其他信息。**攻击者利用这样的状况破坏系统或者插入特别编制的代码，以获得系统控制权。

#### 缓冲区溢出 攻击 的定义

缓冲区溢出攻击是指攻击者利用溢出漏洞精心编写的带有某种不良企图可执行代码(shellcode)的程序，通过在缓冲区**写入超过预定长度的数据造成所谓的溢出**，破坏了堆栈的缓存数据，**使程序的返回地址发生变化**，使它指向溢出程序中shellcode的开始，这样就可以运行攻击者的代码，达到攻击者的目的。

### 缓冲区溢出后果【10.3】

- 程序使用的数据损坏
- 程序中意外的控制权转移
- 非法内存访问冲突
- 导致程序终止
- 系统控制权的转移到攻击者选择的代码 

### 利用任何类型的缓冲区溢出，攻击者需要【10.4】

1. 识别某些程序中的缓冲区溢出漏洞，该漏洞可以使用攻击者控制下的外部来源数据触发
2. 了解该缓冲区将如何存储在进程内存中，从而破坏相邻的内存区域并改变程序的执行流

### 缓冲区溢出的语言【10.5】

1. 易受缓冲区溢出影响的编程语言是**弱变量类型的编程语言**。它们包括汇编语言，以及C和类似的语言。
2. 强类型语言（如Java，ADA，Python和许多其他语言）不容易受到这些攻击。

## 10.1 栈溢出

### 10.1.1 栈溢出

#### 栈溢出的实现【10.6】

当目标缓冲区位于栈上时，如果将外部源数据复制到此类缓冲区的函数代码超过了其分配的存储能力，则可能会覆盖相邻变量的值，甚至控制字段（如保存的帧指针和返回地址），这可能导致程序崩溃，或者执行被转移到攻击者提供的（shell）代码

#### 函数调用机制

保护现场

传递参数

提供返回地址

保存局部变量

可能要保存一些寄存器

#### 程序运行时的存储空间结构

程序段:存放程序的机器码和只读数据

全局数据段:存放程序中的静态数据

栈区和堆区:存放程序中的动态数据

栈：有编译器自动分配释放。存放局部变量、编译时已经申请好的，从高向低地址生长（下面是高地址，即朝上）

堆：一般由程序员分配释放（如c语言中的malloc，calloc，new）。存放动态申请的变量，若他不释放，程序结束时可能由OS收回。从高向低生长

![image-20220704151556750](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220704151556750.png)

![image-20220704151820204](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220704151820204.png)

#### 举例：函数Funtion的栈帧

![image-20220803184514934](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220803184514934.png)

#### 补充：内存的概念

小端存储：

大端存储：

未初始化的栈区：烫

未初始化的堆区：屯

### 10.1.3 shellcode

#### shellcode【10.7】

shellcode 是攻击者写入到正在发生溢出的缓冲区中的代码，是与机器代码和数据值相对应的一串二进制值。shellcode可以实施的攻击举例如下：**【10.10】**

1. 生成命令行 shell 
2. 设置监听服务以在连接到时启动远程shell的代码;
3. 创建 一个反向 shell，该 shell 连接回黑客;
4. 本地漏洞利用，用于建立 shell 或执行进程;
5. 刷新当前阻止其他攻击的防火墙规则（如 IPTables 和 IPChains）;
6. 突破 chrooted（受限执行）环境，提供对系统的完全访问权限。 

#### shellcode 的约束条件【10.8】

1. 不能包含任何引用自身的绝对地址，因为攻击者通常无法提前确定目标缓冲区在定义它的函数的堆栈帧中的确切位置。
2. 除了结尾处不能包含任何 NULL 值，因为null标志着字符串结束，没有NULL才能保证shellcode被安全复制到缓冲区内。

#### NOP Sled【10.9】

NOP是不操作、不执行任何命令的指令

NOP sled是一系列NOP指令组成的

为了解决不能准确确定代码段初始地址的问题，攻击者可以使用多个NOP指令填充缓冲区前面的空间，这样不论目标地址在什么地方都会被覆盖，CPU也会一直执行NOP，直至到达shellcode

## 10.2 缓冲区溢出的防御措施

#### 两类防御措施【10.11】

- 编译时防御：旨在强化程序以抵抗新程序中的攻击
- 运行时防御：旨在检测和中止现有程序的攻击。

### 10.2.1 编译时防御 Compile-time 【10.12】

1. **程序设计语言的选择**、语言的扩充和安全库的使用：**尽量采用强类型的语言**（java，python等解释型语言，C#等不涉及内核的语言，Pascal...）和函数，规范代码

2. **使用安全的编码技术**：加强范围检查边界条件、全面考虑各种非法输入

3. **使用安全库函数**：**【T 10.1】**

   | **原始不安全函数** | **更安全的替代方案** |
   | ------------------ | -------------------- |
   | gets               | fgets                |
   | sprintf            | snprintf             |
   | strcat             | strncat              |
   | strcpy             | strncpy              |
   | vsprintf           | vsnprintf            |

3. **栈保护机制**：在函数入口和出口处附加代码，检查帧是否遭到破坏。

#### 栈保护机制

1. **stackguard**：

- 函数入口代码，在为局部变量分配的地址空间之前，在旧的帧指针地址之下写入一个canary（金丝雀）值;
- 在函数的退出操作（恢复旧的帧指针和转移控制权后退到返回地址）之前，添加的函数出口代码**检查canary的值没有变化**。
- 任何为了改变旧的帧指针和返回地址的尝试都将改变这个值，并将会被检测到，此时则返回程序异常终止，不再继续。

​	canary采用**随机生成**机制，且采用**终止符号**（如：null（0x00），CR（0x0d），LF（0x0a），EOF（0xff）等作为开头，print函数遇到这些字符就会停止打印）防止内存中的金丝雀值被输出进而伪造

2. **Stackshield和返回地址保护者**（RAD) :

- 在函数入口处，添加的代码将返回地址的一个副本写到内存的一个安全区域(这个区域要想破坏都非常困难）;
- 在函数的出口处添加的代码检查栈帧里的返回地址与保存的副本，
- 如果发生任何变化就终止程序。

编译时防御都需要对现有的程序重新编译才能利用

### 10.2.2 运行时防御 run-time【10.13】

1. 可执行地址空间保护：阻止在栈、堆或全局数据中执行代码
2. 地址空间随机化ASLR：随机方式设置栈的地址
2. guard页：在进程地址空间中 的关键内存区域之间放置**保护页**

## 10.3 其他形式的溢出攻击

### 10.3.1 替换栈帧

#### 替换栈帧

这种攻击方式的一个变种就是改写缓冲区以及保存的帧指针地址。保存的帧指针值被改变为被改写的缓冲区顶部附近的一个存储单元（这个单元里保存了一个指向shellcode的缓冲区较低位置的虚假栈帧)

#### 差1错误

因编码错误，允许比有效地址空间多一个字节内容复制(例如<和>被误写为<=和>=) 。

#### 替换系统空间中的代码

攻击者将与机器代码指令相应的数值插入到溢出空间
这些代码具有操作系统运行权限，当它能以特权用户身份运行时，可能让普通用户无需经过认证就可以获得系统特权。

### 10.3.2 返回到系统调用【10.14】

如若改变返回地址，就可以让程序跳转到系统现有的代码，避免触发运行时防御。

也可以把两个库函数调用链接在一起，在一个库函数之后调用另一个库函数。能够有效避开非执行堆栈的限制。一般是将第一个地址设置为库函数strcpy()的地址，并指定参数从缓冲区复制shellcode到内存的可执行区域；第二个地址指向shellcode复制到的目标地址

### 10.3.3 堆溢出&全局数据区溢出【10.15】【10.16】

目标缓冲区位于堆上，堆空间中没有容易引发控制权转移的返回地址。但如果里面包含**函数指针**，则可以改写其指向shellcode
防御措施包括使堆不可执行，或随机化堆上结构的地址。

全局数据区溢出的目标位于全局数据区域，攻击和防御类似于堆溢出

#### 利用堆栈指针或返回值的寄存器

函数调用通过堆栈来管理，通过造成堆栈溢出

改变堆栈指针（寄存器的值），即改变过程调用的相关环境。

改变返回地址，造成子过程调用返回后，攻击者可将控制权随心所欲地移交到任何地方

# 第11章 软件安全

## 11.1 软件安全问题

#### 软件质量可靠性与安全性的区别【11.1】

软件质量可靠性：关心的是由于一些理论上随机的，意想不到的输入而导致的程序意外故障。这些故障预计将遵循某种形式的概率分布。

软件安全性：攻击者选择针对导致故障的特定bug。这些错误通常可能由与通常预期的输入有很大不同触发，因此不太可能通过常见的测试方法识别。 

#### 防御性程序设计或安全程序设计（Defensive or Secure Programming)【11.2】

是一个软件设计与实现流程，目的是使生成的软件即使在面临攻击时仍然能够继续工作。如此编写而成的软件能够检测出由攻击所引发的错误条件，并能继续安全地执行;或者即使执行失败，也能优雅地“落地”。**防御性程序设计的关键是绝不做任何假设，但是要检查所有的假设，并处理任何可能的错误状态。**（永远不要相信用户会输入合法的东西）

## 11.2 处理程序输入

#### 程序输入【11.3】

源自程序外部的任何数据源，其值在代码写入时未被程序员明确知道。它包括从用户**键盘或鼠标条目、文件或网络连接读入程序的数据**。它还包括**在执行环境中提供给程序的数据、程序从文件中读取的任何配置或其他数据的值，以及操作系统提供给程序的值**。

对同一个数值不同的解释会有不同的含义

#### 心跳出血 OpenSSL漏洞（22章）

### 11.2.1 程序输入的解释

#### 注入攻击 举例 比较命令&SQL注入【11.4】

是指与输入数据的无效处理相关的各种程序缺陷，特别是当此类输入数据可以意外或故意影响 程序的执行流程时。

注入攻击包括：命令注入、 SQL 注入、代码注入和远程代码注入。

在 **命令注入** 攻击中，未经检查的输入用于构造命令，随后由系统以受攻击程序的权限执行。

在 SQL 注入攻击中，用户提供的输入用于构造 SQL 请求以从数据库中检索信息。

其中包括将输入数据作为参数传递给另一个帮助程序（命令）或数据库系统 （SQL），然后由原始程序处理和使用其输出。或者，当输入包含机器或脚本代码，然后由 受攻击的系统执行/解释（代码）时。 

过滤引号字符、drop、超链接等

#### 跨站脚本攻击->XSS反射【11.6】

攻击者提交给站点的数据中包含恶意脚本，随后输出给另一个用户时，就会发生跨站点脚本攻击。它们最常见于脚本化 Web 应用程序，其中漏洞涉及在用户浏览器显示的网页的 HTML 内容中包含脚本代码。

此类攻击的实例：比如由H5和javascript 代码写出的一个不安全的论坛应用程序，其中一个用户保存的注释包含恶意代码 （图11-5）

### 11.2.2 验证输入语法【11.7】【11.8】

通常采用正则表达式进行以下两种比较

1. 用户输入要与输入假设比较，比较结果仅接收有效输入。
2. 将输入数据与已知的危险数据比较

使用Unicode字符集进行输入验证时，由于多重编程的可能性，必须先将数据转化为**单一**的、**最小**的、**标准**的符号进行检查。

### 11.2.3 fuzzing技术/模糊测试【11.9】

fuzzing技术即“输入模糊测试”，是一种软件测试方式。利用大量随机生成的数据作为程序的输入，以确定程序或函数是否正确处理了所有此类异常输入，或者它是否崩溃或以其他方式无法做出适当的响应确定。

模糊测试的主要优势在于其简单性、低成本以及不受任何程序、服务或功能的“预期”输入的假设。它应该作为任何合理全面的测试策略的一个组成部分进行部署，特别是在与常用部署的软件相关的测试策略中。 

产生一组伪随机数测试程序是否正确执行。产生大量测试的费用很低，但往往只能识别简单的错误。fuzzing技术输入**黑盒测试**。

## 11.3 编写安全程序代码

###  与编写安全程序代码相关的关键软件安全问题【11.10】

- 实现的算法是否正确解决了指定的问题
- 正确执行的机器指令是否正确代表了高级算法规范
- 存储在机器寄存器或存储器中的变量中数据值的操作是否有效和有意义

### 竞争条件【11.11】

进程竞争：当多个进程或一个进程中的线程同时访问同一共享内存而没有适当的同步时，可能会发生争用情况。结果可能是共享内存值可能已损坏，或者由于共享值的重叠访问、使用和替换而丢失了更改。

### 环境变量【11.12】

是每个进程从其父进程中继承的能够影响进程运行方式的一系列字符串。（注意: Windows系统中没有父子进程之分，也不采用进程树管理)

攻击者更改其中一个或多个的值，然后调用以其他（更高）权限运行的脚本，然后“诱骗”运行程序或因此使用攻击者选择的库。 

### 最小特权原则【11.13】

**每个程序都使用完成其功能所需的最小特权**，而不希望其权限扩大。

当一个拥有额外权限的程序受到攻击时，攻击者就可以获得更大权限，对系统造成更大破坏。
最小特权原则要求访问权限尽可能小，时间也尽可能短。Root权限的获取是攻击者的主要目标。
一个良好的防御性程序设计准则:大的、复杂的程序应该尽量分解成小模块，每个模块仅在需要的时候拥有相应的访问权限，尽量增加模块间的隔离度(这样，就能够尽量降低一个组件中安全问题的影响范围，且每个模块的验证都比较简单。)

### 11.4 与操作系统的交互

文件锁【11.14】

临时文件【11.15】

### 11.5 程序输出

#### 格式串漏洞

C语言的 printf() 函数 格式化字符s%和参数s1，s2的个数不匹配：

```c
printf("%s",s1,s2);//cuowu
```

![image-20220706145443908](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220706145443908.png)

# 第12章 操作系统安全

## 12.1 安全步骤

#### [保护]系统安全的步骤【12.1】x

1. 评估风险并规划系统部署 
2. 保护底层操作系统，然后保护关键应用程序 
3. 确保任何关键内容都受到保护 
4. 确保使用适当的网络保护机制 
5. 确保使用适当的流程来维护安全性 

#### [维护]系统安全的步骤【12.9】

1.  监控和分析日志记录信息 
2.  执行定期备份 
3.  从安全隐患中恢复 
4.  定期测试系统安全性 
5.  使用适当的软件维护流程来修补和更新所有关键软件，并根据需要监视和修改配置 

#### 系统安装规划的目的【12.2】

旨在以最小的代价最大限度地提高安全性，同时尽量减少费用，这最好在实施之前完成。它需要确定系统、其应用程序和数据以及其用户的安全条件。

#### 加固基本操作系统步骤是【12.3*】【12.7】

1. 安装并修补操作系统 
2. 通过以下方式强化和配置操作系统，以充分满足 已识别的系统安全需求： 删除不必要的服务、应用程序和协议，配置用户、组和权限 ，配置资源控制 
3. 安装和配置其他安全控件，如nti 病毒、 
4. 基于主机的防火墙和 IDS（如果需要） 
5. 测试基本操作系统的安全性，以确保 
6. 已采取的步骤充分满足其安全需求

可**用于保护基本操作系统的额外安全控制措施**包括：防病毒软件、基于主机的防火墙、IDS 或 IPS 软件以及将应用程序列入白名单。

#### 用于加密关键应用程序的额外步骤包括【12.8】

1.  打好补丁 将每个应用程序安装并升级到最新支持的安全版本 
2.  应用配置 执行特定于应用程序的配置 
3.  加密技术 启用加密并在需要时生成密钥和证书 

#### 软件更新的原因&更新的优缺点&删除服务【12.4】【12.5】【12.6】

由于不断发现软件和常用操作系统和应用程序的其他漏洞，因此保持所有软件尽可能保持最新非常重要。

**优点：当发现新漏洞时** ，最大限度地减少攻击者的机会窗口 ;很方便，特别是如果自动化。 

**缺点：** 补丁有时会带来不稳定，特别是在变更控制系统上。

删除不必要的服务、应用程序和协议的目的是尽量减少可以运行的软件数量，因为如果可供运行的软件较少，则可能包含漏洞的风险就会降低。

## 12.2 Unix/Linux 和 Windows 安全

### 12.2.1 UNIX/Linux

12.10 Unix 和 Linux 系统上的应用程序和服务的配置通常使用 每个应用程序和服务的单独文本文件来实现。系统范围的配置详细信息通常位于 /etc 目录中，或位于特定应用程序的安装树中。

Unix 和 Linux 系统对所有文件系统资源（不仅包括文件和目录，还包括设备、进程、内存以及大多数系统资源）实施自主访问控制 （DAC ）。

权限：是向每个资源的所有者、组和其他人授予读取、写入和执行权限 -- 访问权 

**12.13 Unix** 和 Linux 系统上的这些扩展访问权限通常使用 **getfacl** 和 **setfacl** 命令进行设置和显示。

在 Unix 和 Linux 系统上，将用户（setuid）设置为某个用户（甚至是 root 用户，超级用户）或将组（setgid）设置为某个组的程序以特定用户的权限执行，或者访问属于该组的资源

Linux 系统的主机防火墙现在主要使用 **iptables** 程序来配置 **netfilter** 内核模块。

12.16 * 滚动日志记录可以产生大量信息。可以配置合适的自动日志轮换和归档系统，以帮助管理日志盖因信息的总体大小。

12.17 ![image-20220829165638336](C:\Users\elimx\AppData\Roaming\Typora\typora-user-images\image-20220829165638336.png)

Unix 和 Linux 系统提供了一种在 **chroot jail** 中运行服务的机制，它将文件系统的服务器视图限制为仅指定部分，并有助于控制给定服务受到损害或劫持的影响。 

### 12.2.2 Windows

Windows 系统中的用户和组可以在安全帐户管理器 （SAM） 的单个系统上本地存储和使用。

Unix和Linux系统上的自由访问控制模型的实现之间存在重大差异。Unix和Linux系统对几乎所有资源/对象的所有者/组/其他主体使用少量访问权限 - 这意味着它是一个简单的模型，但是由于到处都使用相同的权限，因此它们 的含义对于不同的对象可能不同，有时很难或不可能指定一些所需的复杂要求。Windows系统使用更大的访问权限集，这些访问权限对于不同类型的对象而有所不同 - 一种更复杂的模型，可能更难掌握，但可以更好地规范某些所需的复杂需求。 

Windows 系统中使用的强制完整性控件将所有对象（如进程和文件）以及所有用户标记为低、中、高 或系统完整性级别。然后，每当数据写入对象时，系统首先确保主体的完整性等于或高于对象的水平，从而实现Biba完整性模型的一种形式。

在 Windows 上，覆盖所有 ACL 检查的权限是备份计算机的能力，这需要覆盖正常的访问控制才能获得完整的备份。 

在 Windows 系统上，许多应用程序和服务配置信息都集中在注册表中，注册表形成了一个键和值的数据库，这些键和值可以由这些系统上的应用程序查询和解释。

## 12.3 虚拟化安全

**【12.23】**虚拟化是指对某些软件使用的计算资源进行抽象的技术，因此这些软件在称为虚拟机（VM）的模拟环境中运行。**【12.24】**虚拟化安全加固：如何保护本机和托管虚拟化变体。 

#### 虚拟化系统的主要安全问题【12.25】

1.  来宾操作系统隔离，确保在来宾操作系统中执行的程序可以不安全地访问和使用分配给它的资源，并且不会与其他来宾操作系统或虚拟机管理程序中的程序或数据进行隐蔽的交互。
2.  由虚拟机管理程序监视来宾操作系统，该虚拟机管理程序对每个来宾操作系统中的程序和数据具有特权访问 权，并且必须被信任为安全，不会受到此访问的子版本和受损使用
3.  虚拟化环境安全性，尤其是有关映像和快照管理的安全性，攻击者可能会尝试查看或修改这些安全性 

#### **保护虚拟化系统**的基本步骤【12.26】

1.  仔细规划虚拟化系统的安全性 
2.  保护完整虚拟化解决方案的所有元素，包括虚拟机管理程序、客户机操作系统和虚拟化基础架构;并维护其安全性 
3.  确保虚拟机管理程序得到适当保护 
4.  限制和保护管理员对虚拟化解决方案的访问

余23、24章在资料和书上整理
